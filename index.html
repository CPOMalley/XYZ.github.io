<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Open House Service Finder</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f8f9fa;
      margin: 0;
      padding: 0;
    }
    .header {
      text-align: center;
      padding: 20px;
      background-color: #fff;
      border-bottom: 1px solid #ccc;
    }
    .header h1 {
      margin: 0;
      color: black;
    }
    .header p {
      margin: 5px 0 0;
      color: black;
    }
    .container {
      max-width: 1200px;
      margin: 20px auto;
      padding: 20px;
      background-color: #fff;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .banner {
      text-align: center;
      background: url('your-skyline-image.jpg') no-repeat center center;
      background-size: cover;
      color: #fff;
      padding: 20px;
      border-radius: 8px;
    }
    .banner h2 {
      margin: 0;
      font-size: 24px;
    }
    .search-container {
      margin-top: 20px;
      text-align: center;
    }
    .search-container input[type="text"] {
      padding: 10px;
      width: 80%;
      max-width: 400px;
      margin-right: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .search-container select {
      padding: 10px;
      margin-right: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .search-container button {
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      background-color: #28a745;
      color: #fff;
      cursor: pointer;
    }
    .map-container {
      margin-top: 20px;
    }
    #map {
      width: 100%;
      height: 400px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    .sidebar {
      margin-top: 20px;
    }
    .sidebar h3 {
      margin-top: 0;
    }
    .selected-companies {
      display: none;
      margin-top: 20px;
    }
    .selected-companies.visible {
      display: block;
    }
    .results-container {
      margin-top: 20px;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      width: 300px;
      text-align: center;
    }
    .modal-content input[type="text"],
    .modal-content input[type="email"] {
      padding: 10px;
      width: 100%;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .modal-content button {
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      background-color: #28a745;
      color: #fff;
      cursor: pointer;
    }
    @media (max-width: 600px) {
      .search-container input[type="text"],
      .search-container select {
        width: 100%;
        margin-bottom: 10px;
      }
      .search-container button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Welcome to Open House</h1>
    <p>Find the best home services for your open house.</p>
  </div>
  <div class="container">
    <div class="banner">
      <h2>Home Services Finder</h2>
    </div>
    <div class="search-container">
      <p>To begin looking for local professionals, please enter the address for the home you are listing below:</p>
      <input type="text" id="address" placeholder="Enter your address">
      <select id="radius">
        <option value="<5 miles"><5 miles</option>
        <option value="5-25 miles">5-25 miles</option>
        <option value="25-50 miles">25-50 miles</option>
        <option value="50-100 miles">50-100 miles</option>
        <option value="100+ miles">100+ miles</option>
      </select>
      <button onclick="searchAddress()">Search</button>
    </div>
    <div class="map-container">
      <div id="map"></div>
    </div>
    <div class="sidebar">
      <h3>Select Services</h3>
      <label><input type="checkbox" value="cleaning"> Cleaning</label>
      <label><input type="checkbox" value="moving"> Moving</label>
      <label><input type="checkbox" value="photography"> Photography</label>
      <label><input type="checkbox" value="staging"> Staging</label>
      <label><input type="checkbox" value="landscaping"> Landscaping</label>
      <label><input type="checkbox" value="storage"> Storage</label>
      <button onclick="selectServices()">Select Services</button>
    </div>
    <div id="results" class="results-container"></div>
    <div id="selected-companies" class="selected-companies">
      <h3>Selected Companies</h3>
      <div id="selected-companies-list"></div>
      <button onclick="saveAsPDF()">Save as PDF</button>
      <div id="new-search" onclick="startNewSearch()" style="cursor:pointer; color:blue; text-decoration:underline; margin-top: 10px;">Start a New Search</div>
    </div>
  </div>

  <div id="userInfoModal" class="modal">
    <div class="modal-content">
      <p>To generate a list of the selected companies, please enter the following information:</p>
      <input type="text" id="firstName" placeholder="First Name">
      <input type="text" id="lastName" placeholder="Last Name">
      <input type="email" id="email" placeholder="Email Address">
      <button onclick="submitUserInfo()">Submit</button>
    </div>
  </div>

  <script>
    var map;
    var service;
    var infowindow;
    var userLocation = null;

    function initMap() {
      map = new google.maps.Map(document.getElementById('map'), {
        center: {lat: -33.867, lng: 151.195},
        zoom: 15
      });

      var input = document.getElementById('address');
      var autocomplete = new google.maps.places.Autocomplete(input);
      autocomplete.bindTo('bounds', map);

      var marker = new google.maps.Marker({
        map: map,
        anchorPoint: new google.maps.Point(0, -29)
      });

      autocomplete.addListener('place_changed', function() {
        infowindow.close();
        marker.setVisible(false);
        var place = autocomplete.getPlace();
        if (!place.geometry) {
          window.alert("Autocomplete's returned place contains no geometry");
          return;
        }

        if (place.geometry.viewport) {
          map.fitBounds(place.geometry.viewport);
        } else {
          map.setCenter(place.geometry.location);
          map.setZoom(17);
        }
        marker.setPosition(place.geometry.location);
        marker.setVisible(true);

        userLocation = place.geometry.location;
      });
    }

    function searchAddress() {
      var address = document.getElementById('address').value;
      if (!address) {
        alert('Please enter an address.');
        return;
      }

      var geocoder = new google.maps.Geocoder();
      geocoder.geocode({'address': address}, function(results, status) {
        if (status === 'OK') {
          map.setCenter(results[0].geometry.location);
          userLocation = results[0].geometry.location;
          document.getElementById('new-search').style.display = 'block';
        } else {
          alert('Geocode was not successful for the following reason: ' + status);
        }
      });
    }

    function filterPlaces(type, callback) {
      var request = {
        location: userLocation,
        radius: document.getElementById('radius').value,
        type: [type]
      };

      service = new google.maps.places.PlacesService(map);
      service.nearbySearch(request, function(results, status) {
        if (status === google.maps.places.PlacesServiceStatus.OK) {
          callback(results, type);
        } else {
          alert('Places search was not successful for the following reason: ' + status);
        }
      });
    }

    function selectServices() {
      var selectedServices = [];
      document.querySelectorAll('.sidebar input[type="checkbox"]:checked').forEach(function(checkbox) {
        selectedServices.push(checkbox.value);
      });

      if (selectedServices.length === 0) {
        alert('Please select at least one service.');
        return;
      }

      var resultsContainer = document.getElementById('results');
      resultsContainer.innerHTML = '<h3>Selected Services</h3>';

      selectedServices.forEach(function(service) {
        filterPlaces(service, function(results, type) {
          var serviceContainer = document.createElement('div');
          serviceContainer.innerHTML = `<h4>${type.charAt(0).toUpperCase() + type.slice(1)} Companies</h4>`;
          results.forEach(function(place) {
            var div = document.createElement('div');
            div.innerHTML = `<strong>${place.name}</strong><br>${place.vicinity}<br><a href="${place.url}" target="_blank">View on Google Maps</a>`;
            serviceContainer.appendChild(div);
          });
          resultsContainer.appendChild(serviceContainer);
        });
      });

      document.getElementById('selected-companies').classList.add('visible');
    }

    function saveAsPDF() {
      var pdfContent = document.getElementById('selected-companies-list').innerHTML;
      var opt = {
        margin:       1,
        filename:     'selected-companies.pdf',
        image:        { type: 'jpeg', quality: 0.98 },
        html2canvas:  { scale: 2 },
        jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
      };
      html2pdf().from(pdfContent).set(opt).save();
    }

    function startNewSearch() {
      location.reload();
    }

    function submitUserInfo() {
      var firstName = document.getElementById('firstName').value;
      var lastName = document.getElementById('lastName').value;
      var email = document.getElementById('email').value;

      if (!firstName || !lastName || !email) {
        alert('Please fill out all fields.');
        return;
      }

      var selectedCompanies = document.querySelectorAll('.sidebar input[type="checkbox"]:checked');
      var selectedCompaniesList = document.getElementById('selected-companies-list');
      selectedCompaniesList.innerHTML = '';

      selectedCompanies.forEach(function(company) {
        var div = document.createElement('div');
        div.innerHTML = `<strong>${company.value}</strong><br>`;
        selectedCompaniesList.appendChild(div);
      });

      document.getElementById('userInfoModal').style.display = 'none';
      document.getElementById('selected-companies').classList.add('visible');
    }

    window.onload = function() {
      initMap();
      document.getElementById('new-search').style.display = 'none';
    };
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAjvhwXqY-7SRYOxRIJqvMnyki9Aq6vaVs&libraries=places&callback=initMap"
    async defer></script>
</body>
</html>
